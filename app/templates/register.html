{% extends "base.html" %}

{% block title %}Registro - Anti-Bullying App{% endblock %}

{% block content %}
<div
    style="max-width: 400px; margin: 3rem auto; padding: 2rem; background: white; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
    <h2 style="text-align: center; color: #2c3e50; margin-bottom: 2rem;">Crear Cuenta</h2>

    {% if error %}
    <div
        style="background: #ffebee; color: #c0392b; padding: 0.8rem; border-radius: 4px; margin-bottom: 1.5rem; text-align: center;">
        {{ error }}
    </div>
    {% endif %}

    <form action="/auth/register" method="POST">
        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Nombre Completo</label>
            <input type="text" name="full_name" required
                style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Email</label>
            <input type="email" name="email" required
                style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Contrase√±a</label>
            <div style="position: relative;">
                <input type="password" name="password" id="password" required
                    style="width: 100%; padding: 0.8rem; padding-right: 40px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                <button type="button" onmousedown="showPassword('password')" onmouseup="hidePassword('password')"
                    onmouseout="hidePassword('password')"
                    style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #7f8c8d;">
                    üëÅÔ∏è
                </button>
            </div>
            <small style="color: #7f8c8d; font-size: 0.8rem;">M√≠n. 10 caracteres, 1 May√∫scula, 1 N√∫mero, 1
                S√≠mbolo.</small>
        </div>

        <div style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Confirmar Contrase√±a</label>
            <div style="position: relative;">
                <input type="password" name="confirm_password" id="confirm_password" required
                    style="width: 100%; padding: 0.8rem; padding-right: 40px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                <button type="button" onmousedown="showPassword('confirm_password')"
                    onmouseup="hidePassword('confirm_password')" onmouseout="hidePassword('confirm_password')"
                    style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #7f8c8d;">
                    üëÅÔ∏è
                </button>
            </div>
        </div>

        <script>
            function showPassword(id) {
                document.getElementById(id).type = "text";
            }
            function hidePassword(id) {
                document.getElementById(id).type = "password";
            }
        </script>

        <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Soy...</label>
            <select name="role" required id="roleSelect" onchange="toggleTeacherFields()"
                style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
                <option value="parent">Padre / Madre / Tutor / a</option>
                <option value="teacher">Profesor / a / Docente</option>
                <option value="school_admin">Director / a</option>
                <option value="super_admin">Conselleria</option>
            </select>
        </div>

        <div id="schoolCodeField" style="margin-bottom: 1rem; display: none;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">C√≥digo del Centro (Opcional)</label>
            <input type="text" name="center_code" placeholder="Ej: MAD-001"
                style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
            <small style="color: #7f8c8d; font-size: 0.8rem;">Si trabajas en un colegio registrado, introduce su
                c√≥digo.</small>
        </div>

        <script>
            function toggleTeacherFields() {
                const role = document.getElementById('roleSelect').value;
                const field = document.getElementById('schoolCodeField');
                if (role === 'teacher' || role === 'school_admin' || role === 'super_admin') {
                    field.style.display = 'block';

                    const input = field.querySelector('input');
                    const label = field.querySelector('label');

                    if (role === 'school_admin') {
                        input.required = true;
                        label.innerText = "C√≥digo de Centro";
                        input.placeholder = "Ej: MAD-001 (Obligatorio)";
                    } else if (role === 'super_admin') {
                        input.required = true;
                        label.innerText = "Clave de Acceso";
                        input.placeholder = "Introduce la clave de acceso (Obligatorio)";
                    } else {
                        input.required = false; // Opcional para profesorado
                        label.innerText = "C√≥digo de Centro";
                        input.placeholder = "Ej: MAD-001 (Opcional)";
                    }
                } else {
                    field.style.display = 'none';
                    field.querySelector('input').value = ''; // Limpiar si cambia a padre
                }
            }

            document.querySelector('form').addEventListener('submit', function (e) {
                const p1 = document.getElementById('password').value;
                const p2 = document.getElementById('confirm_password').value;

                if (p1 !== p2) {
                    e.preventDefault();
                    alert("Las contrase√±as no coinciden.");
                }
            });
        </script>

        <div style="margin-bottom: 1.5rem; display: flex; align-items: start; gap: 0.5rem;">
            <input type="checkbox" name="gdpr_consent" id="gdpr_consent" required style="margin-top: 4px;">
            <label for="gdpr_consent" style="font-size: 0.9rem; color: #555;">
                He le√≠do y acepto la <a href="/auth/privacy-policy" target="_blank" style="color: #3498db;">Pol√≠tica de
                    Privacidad</a> y el tratamiento de
                mis datos personales.
            </label>
        </div>

        <button type="submit"
            style="width: 100%; padding: 0.8rem; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
            Registrarse
        </button>
    </form>

    <p style="text-align: center; margin-top: 1.5rem; font-size: 0.9rem;">
        ¬øYa tienes cuenta? <a href="/auth/login" style="color: #3498db; text-decoration: none;">Inicia Sesi√≥n</a>
    </p>
</div>
{% endblock %}