{% extends "base.html" %}

{% block title %}Mi Familia - Panel de Control{% endblock %}

{% block content %}
<div style="padding: 2rem; max-width: 900px; margin: 0 auto;">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h1 style="color: #2c3e50;">Mis Hijos / as</h1>
            <p style="color: #7f8c8d;">Gestiona los perfiles y realiza los seguimientos semanales.</p>
        </div>
        <a href="/parents/add_child_form"
            style="background: #3498db; color: white; padding: 0.8rem 1.5rem; text-decoration: none; border-radius: 6px; font-weight: 500;">
            + A√±adir Hijo / a
        </a>
    </header>

    <!-- Notificaciones -->
    <div id="notification-area"></div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const msg = urlParams.get('message');
        if (msg) {
            const div = document.createElement('div');
            div.style.padding = '1rem';
            div.style.marginBottom = '2rem';
            div.style.borderRadius = '6px';
            div.style.background = '#d4edda';
            div.style.color = '#155724';
            div.style.border = '1px solid #c3e6cb';
            div.innerText = msg;
            document.getElementById('notification-area').appendChild(div);
            // Limpiar URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>

    {% if children %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
        {% for child in children %}
        <div
            style="background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid {{ '#2ecc71' if child.teacher_id else '#f39c12' }};">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <div>
                    <h2 style="margin: 0; font-size: 1.2rem; color: #2c3e50;">{{ child.name if child.name else
                        child.internal_code }}</h2>
                    <p style="margin: 0; color: #95a5a6; font-size: 0.8rem; font-family: monospace;">ID: {{
                        child.internal_code }}</p>
                    <p style="margin: 0.5rem 0 0 0; color: #7f8c8d; font-size: 0.9rem;">{{ child.grade_class }}</p>
                </div>
                {% if child.teacher_id %}
                <span
                    style="background: #eaffee; color: #27ae60; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                    Vinculado
                </span>
                {% else %}
                <span
                    style="background: #fff3cd; color: #856404; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                    Sin Vincular
                </span>
                {% endif %}
            </div>

            <div style="margin-top: 1.5rem;">
                <p style="font-size: 0.9rem; color: #95a5a6; margin-bottom: 0.5rem;">
                    Colegio: {{ child.school.name if child.school else 'Sin asignar' }}
                </p>

                {% if not child.teacher_id %}
                <div
                    style="margin-bottom: 1rem; padding: 0.5rem; background: #fff3cd; border-radius: 4px; font-size: 0.85rem; color: #856404;">
                    ‚ö† <strong>Modo Local:</strong> Puedes rellenar encuestas, pero el profesor / a no las ver√° hasta que
                    <a href="/parents/edit_child_form?student_id={{ child.id }}">vincules un c√≥digo</a>.
                </div>
                {% endif %}

                <a href="/surveys/parent?student_id={{ child.id }}"
                    style="display: block; text-align: center; background: {{ '#2ecc71' if child.teacher_id else '#f1c40f' }}; color: {{ 'white' if child.teacher_id else '#333' }}; padding: 0.8rem; text-decoration: none; border-radius: 6px; font-weight: 600; transition: opacity 0.2s;">
                    üìù Rellenar Informe Semanal
                </a>

                <div style="margin-top: 1rem; text-align: right;">
                    <a href="/parents/edit_child_form?student_id={{ child.id }}"
                        style="color: #95a5a6; font-size: 0.9rem; text-decoration: none;">
                        ‚öôÔ∏è Editar Perfil
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 4rem; background: white; border-radius: 12px; border: 2px dashed #dcdcdc;">
        <h3 style="color: #95a5a6;">No tienes hijos / as registrados</h3>
        <p style="color: #bdc3c7;">A√±ade el perfil de tu hijo / a para empezar el seguimiento.</p>
    </div>
    {% endif %}
</div>
{% endblock %}